# ~~ AdminArticleMetadata:FunctionalTest -> AdminArticleMetadata:Page~~
suite: Autocheck
testset: Autocheck
tests:

- title: Preparation
  context:
    role: Any Authenticated User
  steps:
  - step: Activate the testdrive setup for this test suite, by using the following url
    path: /testdrive/autocheck
    results:
    - You receive the testdrive setup details, including an admin account for you to use, 
      and an application and journal which have been autochecked for testing
  - step: Log into DOAJ using the admin credentials supplied by the testdrive.  You may want to do 
      this in a private browsing window, so you can remain logged in to your own account in your
      main window.
    path: /account/login
    results:
    - You are logged in as an admin user
  - step: You may now proceed to the tests below

- title: Application autochecks
  context:
    role: Admin
  depends:
  - suite: Autocheck
    testset: Autocheck
    test: Preparation
  steps:
  - step: Go to the Application admin_url supplied by the testdrive setup
    results:
    - You are looking at a test Application created for this test
  - step: Scroll down to find the ISSN (print) and ISSN (online) fields
    results:
      - Both fields are annotated with a green tick, and text which says that ISSN
        is fully registered at ISSN.org
  - step: Click on one of the "see record" links in the annotation
    results:
      - The link is opened in a new window/tab
      - You are taken to the ISSN.org record.  Note that for the purposes of this test, this
        is a random record on ISSN.org, unrelated to the actual record in DOAJ.
  - step: close the ISSN.org window/tab and return to the application form
  - step: Click the "Dismiss" button on both annotations by the ISSN fields
    results:
      - The annotations are removed from the form, and replaced with text indicating that the
        check was dismissed
      - On the right-hand side of the form, beneath the notes, there is a section "Dismissed Autochecks"
        which lists both annotations you just dismissed.  This section is beneath the scrolling notes section,
        you may need to hover and scroll the notes section to see it.
  - step: Click "Undismiss" by the text on the form for the ISSN (print) field which indicates that a check was dismissed
    results:
      - The annotation is restored to the form
      - The annotation disappears from the "Dismissed Autochecks" section, leaving only one record there now
  - step: Click "Undismiss" by the record in the "Dismissed Autochecks" section
    results:
      - The annotation is restored to the form
      - The annotation disappears from the "Dismissed Autochecks" section, leaving no records there now
  - step: Scroll to the "Best Practice" section of the application form, and look at the "Long-term preservation services" question
    results:
      - 2 checks are visible attached to this question, one for CLOCKSS and one for LOCKSS, indicating that they
        are present in Keepers Registry
  - step: Click on one of the "see record" links in the annotation
    results:
      - The link is opened in a new window/tab
      - You are taken to the ISSN.org record.  Note that for the purposes of this test, this
        is a random record on ISSN.org, unrelated to the actual record in DOAJ.
  - step: close the ISSN.org window/tab and return to the application form
  - step: Click "Dismiss" by both notifications
    results:
      - The annotations are removed from the form, and replaced with text indicating that the
        check was dismissed
      - The "Dismissed Autochecks" section lists both checks you just dismissed

- title: Journal autochecks
  context:
    role: Admin
  depends:
  - suite: Autocheck
    testset: Autocheck
    test: Preparation
  steps:
  - step: Go to the Journal admin_url supplied by the testdrive setup
    results:
    - You are looking at a test Journal created for this test
  - step: Scroll down to find the ISSN (print) and ISSN (online) fields
    results:
      - Both fields are annotated with a green tick, and text which says that ISSN
        is fully registered at ISSN.org
  - step: Click on one of the "see record" links in the annotation
    results:
      - The link is opened in a new window/tab
      - You are taken to the ISSN.org record.  Note that for the purposes of this test, this
        is a random record on ISSN.org, unrelated to the actual record in DOAJ.
  - step: close the ISSN.org window/tab and return to the journal form
  - step: Click the "Dismiss" button on both annotations by the ISSN fields
    results:
      - The annotations are removed from the form, and replaced with text indicating that the
        check was dismissed
      - On the right-hand side of the form, beneath the notes, there is a section "Dismissed Autochecks"
        which lists both annotations you just dismissed.  This section is beneath the scrolling notes section,
        you may need to hover and scroll the notes section to see it.
  - step: Click "Undismiss" by the text on the form for the ISSN (print) field which indicates that a check was dismissed
    results:
      - The annotation is restored to the form
      - The annotation disappears from the "Dismissed Autochecks" section, leaving only one record there now
  - step: Click "Undismiss" by the record in the "Dismissed Autochecks" section
    results:
      - The annotation is restored to the form
      - The annotation disappears from the "Dismissed Autochecks" section, leaving no records there now
  - step: Scroll to the "Best Practice" section of the application form, and look at the "Long-term preservation services" question
    results:
      - 2 checks are visible attached to this question, one for CLOCKSS and one for LOCKSS, indicating that they
        are present in Keepers Registry
  - step: Click on one of the "see record" links in the annotation
    results:
      - The link is opened in a new window/tab
      - You are taken to the ISSN.org record.  Note that for the purposes of this test, this
        is a random record on ISSN.org, unrelated to the actual record in DOAJ.
  - step: close the ISSN.org window/tab and return to the journal form
  - step: Click "Dismiss" by both notifications
    results:
      - The annotations are removed from the form, and replaced with text indicating that the
        check was dismissed
      - The "Dismissed Autochecks" section lists both checks you just dismissed

- title: Teardown
  context:
    role: Any Authenticated User
  steps:
  - step: Close your private browsing window you used for the test
  - step: Click the "Teardown" url supplied by the testdrive setup
    results:
    - You receive a success notification in your browser window
  - step: You can now close the testdrive browser tab/window