suite: Autoassign
testset: Autoassign

tests:
  - title: Autoassign by Publisher Account
    setup:
      - Run the autoassign testdrive at /testdrive/autoassign if you have not already done so
    context:
      role: publisher, admin
    steps:
      - step: Using the details under `map_by_account` in the testdrive setup, log in using the `publisher_username` 
              and `publisher_password`
        path: /account/login
      - step: Go to the Publisher's list of Update Requests
        results:
          - There is one update request in the list, and you have an Edit button available
      - step: Click on the Edit button for the update request
      - step: Make a minor change to the form data (e.g. change a URL or a title), then go to the final page
              of the form, select the confirmation checkbox, and click Submit.
      - step: Log out of the Publisher account
      - step: Using the details under `map_by_account` in the testdrive setup, log in using the `maned_username` and 
              `maned_password`
        results:
          - You are taken to the Managing Editor's dashboard
          - There is a card on the dashboard for an Update Request, with the title of the journal you just edited
          - The editor group for the card is identified as "Account Mapping"
      - step: Click on the Update Request card
        results:
          - You are taken to the Update Request form for the journal you just edited
          - The Group field is set to "Account Mapping"
          - There is no Individual editor set
          - There is a note with a recent timestamp indicating that this update request was autoassigned, and the
            reason for the assignment

  - title: Autoassign by Country
    setup:
      - Run the autoassign testdrive at /testdrive/autoassign if you have not already done so
    context:
      role: publisher, admin
    steps:
      - step: Using the details under `map_by_account` in the testdrive setup, log in using the `publisher_username` 
              and `publisher_password`
        path: /account/login
      - step: Go to the Publisher's list of Update Requests
        results:
          - There is one update request in the list, and you have an Edit button available
      - step: Click on the Edit button for the update request
      - step: Make a minor change to the form data (e.g. change a URL or a title), then go to the final page
              of the form, select the confirmation checkbox, and click Submit.
      - step: Log out of the Publisher account
      - step: Using the details under `map_by_account` in the testdrive setup, log in using the `maned_username` and 
              `maned_password`
        results:
          - You are taken to the Managing Editor's dashboard
          - There is a card on the dashboard for an Update Request, with the title of the journal you just edited
          - The editor group for the card is identified as "Account Mapping"
      - step: Click on the Update Request card
        results:
          - You are taken to the Update Request form for the journal you just edited
          - The Group field is set to "Account Mapping"
          - There is no Individual editor set
          - There is a note with a recent timestamp indicating that this update request was autoassigned, and the
            reason for the assignment


