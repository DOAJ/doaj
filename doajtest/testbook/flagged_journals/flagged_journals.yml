suite: Flagged Journals

testset: Flagged Journals

tests:
  - title: Admin - Add, Edit, Resolve
    context:
      role: Admin
    steps:
      - step: Navigate to /testdrive/flags
      - step: In a separate tab login as LordWiggleworth (admin)
      - step: Open Feline Aerodynamics Review journal (available on your dashboard)
        results:
          - Above the notes there is the Add Flag button visible and active
      - step: Click Add Flag button
        results:
          - An empty flag form is displayed
      - step: In assigned_to input attempt to add "MadamPonderleaf" (an editor)
        results:
          - No matches found is displayed and it is not possible to assign the editor
      - step: In assigned_to input add "ProfessorQuibbleton" (admin)
        results:
          - Id is found and it can be selected
      - step: Select "ProfessorQuibbleton"
      - step: In deadline input add an improbable date (e.g., 2025-02-31)
        results:
          - It's not possible to enter an improbable date
      - step: In deadline input add a date in a past
        results:
          - A warning "Provided deadline is in the past. Is it correct?" is displayed under the deadline input
      - step: Save the form (do not close it)
        results:
          - Journal form is saved correctly
      - step: In deadline input add a date in exactly 1 week
        results:
          - Warning disappears
      - step: In text area add flag's note (any text)
      - step: Save application
        results:
          - The flag is saved and additional data (Created by <i>user</i> at <i>date</i>) are displayed
          - All fields are editable
          - Add Flag button is disabled
      - step: Close the application with Unlock & Close
      - step: Open The Bermuda Triangle Journal of Lost and Found record (available on your dashboard)
        results:
          - The record has a flag assigned to another user, with no deadline and with a note.
          - All flag fields are editable
          - Add Flag button is disabled
      - step: Add a valid deadline to a flag (e.g., 2025-04-01)
      - step: Save the record
        results:
          - The flag is correctly saved with a new deadline
      - step: Click Resolve Flag button
        results:
          - The flag is marked as resolved
          - Add Flag button is active
          - Undo Resolving button is active
      - step: Click Undo Resolving
        results:
          - The flag is displayed in normal mode
      - step: Click Resolve Flag
      - step: Click Add Flag
        results:
          - A new empty flag form is displayed above the resolved flag
          - Add Flag button is disabled
          - Resolve Flag under the previous flag is disabled
      - step: Click Cancel to cancel adding a flag
        results:
          - The empty form is hidden
          - Undo Resolving and Add Flag buttons are active
      - step: Click Add Flag button
      - step: Add a new flag by assigning an admin and providing a note, then saving the application
        results:
          - The new flag is saved and displayed
          - The old flag was converted to a note with text This flag was resolved on <i>date</i> by <your id>; and flag's note
      - step: Click Unlock & Close to close the application
      - step: Open Journal of Intergalactic Diplomacy record
        results:
          - This record has a flag assigned to you
          - In the flag form, in the Assign a User input, there is your id with a red flag icon
          - Resolve Flag button is active and all fields are editable

  - title: Admin - Flags Notifications
    context:
      role: Admin
    setup: If you haven't performed previous test (Admin - Add, Edit, Resolve) prepare the Journal by following the steps 1-8; otherwise you may start from the step 9;
    steps:
      - step: Login as LordWiggleworth (admin)
      - step: Open Feline Aerodynamics Review journal (available on your dashboard)
      - step: Click Add Flag button
      - step: Assign "ProfessorQuibbleton" (admin)
      - step: Add deadline in exactly 1 week
      - step: In text area add flag's note (any text)
      - step: Save application, Unlock & Close the form
      - step: Log out
      - step: Log in as "ProfessorQuibbleton"
        results:
          - At the top navbar Notifications indicate a new notification
      - step: Hover over Notifications button
        result:
          - At the top of the list new notification "New flag" is listed
      - step: Click on the notification
        results:
          - Feline Aerodynamics Review journal form is opened in a new tab
          - On the right the flag is displayed and assigned to you ("ProfessorQuibbleton")
      - step: Unlock & Close the form, close the tab
      - step: Click the Notifications button at the top navigation bar
        results:
          - /dashboard/notifications opens
          - At the top of the list "New flag" notification is displayed.
          - The long description says "A new flag in 'Feline Aerodynamics Review' (id) has been assigned to you"
      - step: Open the testdrive/flags page <b>do not close the page where you are logged in</b>
      - step: Click "Run background task" button, wait for the task to execute
        result:
          - Message "Script executed successfully!" is displayed
      - step: Go back to the tab where you are logged as ProfessorQuibbleton
      - step: refresh the page
      - step: navigate to /dashboard/notifications if not already there
        results:
          - At the top of the notifications list a new notification "Deadline reminder" is listed
          - Long description says "The deadline for the flag in 'Feline Aerodynamics Review' (id) is in 7 days."
          - At the top navbar Notifications button has a new notification marked
      - step: Click "See action" link at the right of the new "Deadline reminder" notification
        results:
          - Feline Aerodynamics Review journal form is opened in a new tab
      - step: Unlock & Close the form, close the tab

  - title: Admin - Dashboard [NOT CURRENTLY USED]
    context:
      role: Admin
    steps:
      - step: Navigate to /testdrive/flags
      - step: Login as an admin
        results:
          - You are presented with your dashboard
          - The following records are displayed in your dashboard
          - Journal of Intergalactic Diplomacy - an application flagged to you with an urgent deadline (within 7 days), assigned to an associate in a group you are not a member of, marked as Flagged to you (Urgent Deadline)
          - Journal of Quantum Homeopathy - an update request flagged to you with an urgent deadline (within 7 days), assigned to an associate from your group, marked as Flagged to you (Urgent Deadline)
          - The Mars Agricultural Review - an application with a non-urgent flag (deadline in more than 7 days), marked as Flagged to you
          - Cryptid Behavioral Studies Quarterly - an update request with a non-urgent flag (with no deadline), marked as Flagged to you
          - The Bermuda Triangle Journal of Lost and Found - an application assigned to an editor from your group, flagged to someone else, NOT marked as flagged
          - Feline Aerodynamics Review - an update request assigned to you, with no flags
          - You DO NOT see the Applied Alchemy & Unstable Chemistry update request (flagged to someone else and not assigned to your group)
          - Records with deadlines are ordered from the most urgent to the least urgent
      - step: Open Cryptid Behavioral Studies Quarterly journal
      - step: Change the deadline of the flag to the past (e.g., 2020-01-01)
      - step: Save the record and then unlock and close
      - step: Go back to your dashboard and refresh the page
        results:
          - Cryptid Behavioral Studies Quarterly is now displayed first as the most urgent, and it is marked as Flagged to you (Urgent Deadline)
      - step: Click on the New Applications filter
        results:
          - Records Journal of Intergalactic Diplomacy and The Mars Agricultural Review are listed
      - step: Click on the Update Requests filter
        results:
          - Records Cryptid Behavioral Studies Quarterly, Journal of Quantum Homeopathy and Feline Aerodynamics Review are displayed
      - step: Click on the On Hold filter
        results:
          - Record The Bermuda Triangle Journal of Lost and Found is listed

  - title: Admin - Search
    context:
      role: Admin
    steps:
      - step: Navigate to /testdrive/flags
      - step: Login as an admin
      - step: Navigate to /admin/applications
      - step: Select Only Flagged Records
        results:
          - Only flagged records are listed
          - Records flagged to someone else are marked with an empty flag
          - Records flagged to you are marked with a full flag
          - When a flag has a deadline, it is displayed under Alternative Title
      - step: Select "Only Flagged to Me" filter
        results:
          - Only records flagged to you are listed
          - Records flagged to you are marked with a full flag
          - When a flag has a deadline, it is displayed under Alternative Title

  - title: Editor
    context:
      role: Editor
    steps:
      - step: Navigate to /testdrive/flags
      - step: Login as MadamPonderleaf (editor)
      - step: Navigate to /applications
      - step: Open to Open Journal of Intergalactic Diplomacy - make sure you haven't resolved the flag while logged as an admin in one of the previous tests
        results:
          - There is no information about any flags and "Add flag" button is **not** displayed
      - step: Navigate to /editor/your_applications
        results:
          - There is no information about any flags
          - Only Flagged Records and Flagged to you" facets are **not** displayed