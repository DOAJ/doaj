{% extends "layouts/base.html" %}

{% block body_class %}
journal-details
{% endblock %}

{% block page_title %}
    {% set metatitle = bibjson.title %}
    {% if current_volume %}{% set metatitle = metatitle + ', ' + 'Volume ' + current_volume %}{% endif %}
    {% if current_issue %}{% set metatitle = metatitle + ', ' + 'Issue ' + current_issue %}{% endif %}
    {% set metatitle = metatitle + ' | ' + app.config['SERVICE_NAME'] %}
    <title>{{ metatitle }}</title>
{% endblock %}

{% block page_desc %}<meta name="description" content="Information about the open-access journal {{ bibjson.title }} in DOAJ. {{ app.config['SERVICE_TAGLINE'] }}">{% endblock %}

{% block extra_stylesheets %}
    {% include "_edges_common_css.html" %}
{% endblock %}

{% block content %}

{%- set CC_MAP = {
        "CC BY" : ["/static/doaj/images/cc/by.png", "https://creativecommons.org/licenses/by/4.0/"],
        "CC BY-NC" : ["/static/doaj/images/cc/by-nc.png", "https://creativecommons.org/licenses/by-nc/4.0/"],
        "CC BY-NC-ND" : ["/static/doaj/images/cc/by-nc-nd.png", "https://creativecommons.org/licenses/by-nc-nd/4.0/"],
        "CC BY-NC-SA" : ["/static/doaj/images/cc/by-nc-sa.png", "https://creativecommons.org/licenses/by-nc-sa/4.0/"],
        "CC BY-ND" : ["/static/doaj/images/cc/by-nd.png", "https://creativecommons.org/licenses/by-nd/4.0/"],
        "CC BY-SA" : ["/static/doaj/images/cc/by-sa.png", "https://creativecommons.org/licenses/by-sa/4.0/"]
    }
-%}

{%
    set TYN = {
        True : "Yes",
        "True": "Yes",
        False : "No",
        "False": "No"
    }
%}

    {# FIXME for new data model's support of multiple licenses #}
{% set lic = bibjson.licenses[0] %}

<main class="container page-content">
  <header>
    <p>
      {% if journal.updated %}
      <span class="label label--secondary">
        <span data-feather="clock" aria-hidden="true"></span>
        Updated recently
      </span>
      {% endif %}
      <span class="label">
        <span data-feather="book-open" aria-hidden="true"></span>
        {# this next bit has to be all on one line so that the spacing is correct #}
        {% for identifier in bibjson.get_identifiers(idtype='pissn') %}{{identifier}} (Print){% endfor %}{% for identifier in bibjson.get_identifiers(idtype='eissn') %}{% if bibjson.get_identifiers(idtype='pissn') %}&nbsp;/ {% endif %}{{identifier}} (Online){% endfor %}
      </span>
    </p>

    <h1>
      {{ bibjson.title }}
      {% if bibjson.alternative_title %}
      <span aria-hidden="true">{{ bibjson.alternative_title }}</span>
      {% endif %}
    </h1>

    {%- set seal = journal.has_seal() -%}
    {% if seal %}
    <a href="#" class="tag tag--featured">
      <span data-feather="check-circle" aria-hidden="true"></span>
      DOAJ Seal
    </a>
    {%- endif %}

    {% if bibjson.get_single_url("homepage") %}
    <a href="{{ bibjson.get_single_url('homepage') }}" target="_blank" rel="noopeener" class="tag">
      <span data-feather="external-link" aria-hidden="true"></span>
      Website
    </a>
    {% endif %}

  </header>

  <div class="tabs">
    <nav class="tabs__menu">
      <ul class="tabs__list" role="tablist">
        <li class="tabs__item">
          <a href="#about-journal" role="tab" aria-selected="true">About</a>
        </li>
        <li class="tabs__item"role="presentation">
          <a href="#all-articles" role="tab" aria-selected="false">Articles</a>
        </li>
      </ul>
    </nav>

    <div class="tabs__content">
      <section id="about-journal" class="tabs__panel" role="tabpanel" aria-hidden="false">
        <h2 class="sr-only">About</h2>
        <div class="three-col">
          <section>
            <h3 class="label label--underlined">Publishing with this journal</h3>

            <article class="card card--with-icon">
              <span data-feather="dollar-sign" aria-hidden="true"></span>
              <div>
                {% if not bibjson.apc_url and not bibjson.submission_charges_url and not bibjson.get_single_url("waiver_policy") %}
                  <p>Information on publication charges not available for this journal.</p>

                {% else %}
                  <p>
                    {# APCs #}
                    {% if bibjson.apc.get("currency") or bibjson.apc.get("average_price") %}
                      It costs <strong class="label label--large">{{ bibjson.apc.get("average_price", "price unknown") }} {{ bibjson.apc.get("currency", " currency unknown") }}</strong> for APCs
                      ({% if bibjson.apc_url%}<a href="{{ bibjson.apc_url }}" target="_blank" rel="noopener">{% endif %}article processing charges{% if bibjson.apc_url%}</a>{% endif %})

                    {% else %}
                      There are <strong class="label label--large">No APC<span style="text-transform: lowercase;">s</span></strong> (<a href="{{ bibjson.apc_url }}" target="_blank" rel="noopener">article processing charges</a>) to publish with this journal
                    {% endif %}

                    {# Submission charges #}
                    {% if bibjson.submission_charges.get("currency") or bibjson.submission_charges.get("average_price") %}
                      and there is a {% if bibjson.submission_charges_url %}<a href="{% if bibjson.submission_charges_url %}" target="_blank" rel="noopener">{% endif %}submission charge{% if bibjson.submission_charges_url %}</a>{% endif %} of <strong class="labe label--large">{{ bibjson.submission_charges.get("average_price", "price unknown") }} {{ bibjson.submission_charges.get("currency", " currency unknown") }}</strong>
                    {% else %}
                      and there are <strong>no submission charges</strong>
                    {% endif %}
                  </p>

                  {# Waivers #}
                  {% if bibjson.get_single_url("waiver_policy") %}
                  <p>
                    &rarr; There is a <a href="{{ bibjson.get_single_url('waiver_policy') }}" target="_blank" rel="noopener">waiver policy</a> for these charges.
                  </p>
                  {% endif %}
                {% endif %}
              </div>
            </article>

            <article class="card card--with-icon">
              <span data-feather="user-check" aria-hidden="true"></span>
              <div>
                <p>Look up the journal’s:</p>
                <ul>
                  {% if bibjson.get_single_url("aims_scope") %}
                  <li><a href="{{ bibjson.get_single_url('aims_scope') }}" target="_blank" rel="noopener">Aims & scope</a></li>
                  {% endif %}
                  {% if bibjson.get_single_url("author_instructions") %}
                  <li><a href="{{ bibjson.get_single_url('author_instructions') }}" target="_blank" rel="noopener">Instructions for authors</a></li>
                  {% endif %}
                  {% if bibjson.get_single_url("editorial_board") %}
                  <li><a href="{{ bibjson.get_single_url('editorial_board') }}" target="_blank" rel="noopener">Editorial Board</a></li>
                  {% endif %}
                  {% if bibjson.editorial_review %}
                    {% if bibjson.editorial_review.get("process") or bibjson.editorial_review.get("url") %}
                    <li><strong>{% if bibjson.editorial_review.get("url") %}<a href="{{ bibjson.editorial_review.get('url') }}" target="_blank" rel="noopener">{% endif %}{{ bibjson.editorial_review.get("process", "Review process unknown") }}{% if bibjson.editorial_review.get("url") %}</a>{% endif %}</strong></li>
                    {% endif %}
                  {% endif %}
                </ul>
                {% if journal.plagiarism_check %}
                <p>
                  &rarr; This journal checks for plagiarism
                </p>
                {% endif %}
              </div>
            </article>

            {% if bibjson.publication_time %}
            <article class="card card--with-icon">
              <span data-feather="clock" aria-hidden="true"></span>
              <div>
                Expect on average <strong>{{ bibjson.publication_time }} weeks</strong> from submission to publication.
              </div>
            </article>
            {% endif %}
          </section>

          <section>
            <h3 class="label label--underlined">Best practice</h3>
            <article class="card card--with-icon">
              <span data-feather="unlock" aria-hidden="true"></span>
              <div>
                {% if journal.license %}
                <p>This journal uses
                  {% for license in journal.license %}
                  {% if forloop.first %}
                  {% elsif forloop.last %} &
                  {% else %},
                  {% endif %}
                  a <strong>{{ license }}</strong>
                  {% endfor %}
                  license.
                </p>
                <p>
                  {% for license in journal.license %}
                  <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener" style="text-decoration: none;">
                  {% if license == "CC BY" %}
                  {% include svg/cc.svg %} {% include svg/by.svg %}
                  {% elsif license == "CC BY-NC" %}
                  {% include svg/cc.svg %} {% include svg/by.svg %} {% include svg/nc.svg %}
                  {% endif %}
                  {% if forloop.last %}{% else %}<br/>{% endif %}
                  </a>
                  {% endfor %}
                </p>
                {% endif %}
                <p>
                  &rarr; Look up their <a href="{{bibjson.get_single_url('oa_statement')}}" target="_blank" rel="noopener">open access statement</a> and their <a href="{{lic.get('url')}}" target="_blank" rel="noopener">license terms</a>.
                </p>
              </div>
            </article>

            <article class="card card--with-icon">
              {% include svg/copyright.svg %}
              <div>
                <p>The author does <strong>not</strong> retain unrestricted copyrights and publishing rights.</p>
              </div>
            </article>

            {% if bibjson.archiving_policy %}
            <article class="card card--with-icon">
              <span data-feather="archive" aria-hidden="true"></span>
              <div>
                <p>Articles digitally archived in:</p>
                <ul>
                  <li>{{ bibjson.flattened_archiving_policies|join(", ") }}</li>
                </ul>

                {% if bibjson.archiving_policy.get("url") %}
                <p>
                  &rarr; Find out about their <a href="bibjson.archiving_policy.get("url")" target="_blank" rel="noopener">archiving policy</a>.
                </p>
                {% endif %}
              </div>
            </article>
            {% endif %}

            {% if bibjson.deposit_policy %}
            <article class="card card--with-icon">
              <span data-feather="upload-cloud" aria-hidden="true"></span>
              <div>
                <p>
                  <a href="{{ journal.policy_url }}" target="_blank" rel="noopener">Deposit policy</a> with:
                </p>
                <ul>
                  <li>
                    <a href="https://v2.sherpa.ac.uk/cgi/search/publication/basic?publication_title-auto={{ journal.title | url_encode }}" target="_blank" rel="noopener">
                      Sherpa/ROMEO
                    </a>
                  </li>
                  <li>
                    <a href="https://diadorim.ibict.br/simple-search?query={{ journal.title | url_encode }}" target="_blank" rel="noopener">
                      Diadorim
                    </a>
                  </li>
                  <li>
                    <a href="https://heloise.ccsd.cnrs.fr/search/searchreview?parameter_0={{ journal.title | url_encode }}" target="_blank" rel="noopener">
                      Héloïse
                    </a>
                  </li>
                  <li>
                    <a href="https://www.accesoabierto.net/dulcinea/lista/REVISTA/{{ journal.title | url_encode }}" target="_blank" rel="noopener">
                      Dulcinea
                    </a>
                  </li>
                </ul>
              </div>
            </article>
            {% endif %}
          </section>

          <section>
            <h3 class="label label--underlined">Journal metadata</h3>

            <article class="card card--with-icon">
              <span data-feather="map-pin" aria-hidden="true"></span>
              <dl>
                {% if bibjson.publisher %}
                <dt>Publisher</dt>
                <dd>{{bibjson.publisher}}{% if bibjson.country %}, {{bibjson.country_name()}}{% endif %}</dd>
                {% endif %}

                {% if bibjson.institution %}
                <dt>Society or institution</dt>
                <dd>{{bibjson.institution}}{% if bibjson.institution_country %}, {{ bibjson.institution_country }}{% endif %}</dd>
                {% endif %}

                {% if bibjson.language %}
                <dt>Manuscripts accepted in</dt>
                <dd>{{bibjson.language_name()|join(", ")}}</dd>
                {% endif %}
              </dl>
            </article>

            <article class="card card--with-icon">
              <span data-feather="tag" aria-hidden="true"></span>
              <dl>
                <dt>LCC subjects <a href="https://www.loc.gov/catdir/cpso/lcco/" target="_blank" rel="noopener"><span data-feather="help-circle" aria-hidden="true"></span></a></dt>
                {% assign lcc_codes = journal.lcc | split: "|" %}
                <dd>
                  {% for code in lcc_codes %}
                    <a href="{{ site.baseurl }}{% link search/journals.md %}">{{ code }}</a>{% if forloop.last %}{% else %}, {% endif %}
                  {% endfor %}
                </dd>

                {% if journal.keywords %}
                <dt>Keywords</dt>
                <dd>
                  {% for keyword in journal.keywords %}
                  <a href="{{ site.baseurl }}{% link search/articles.md %}">{{ keyword }}</a>{% if forloop.last %}{% else %}, {% endif %}
                  {% endfor %}
                </dd>
                {% endif %}
              </dl>
            </article>
          </section>
        </div>
      </section>

      <section id="all-articles" class="row tabs__panel" role="tabpanel" aria-hidden="true">
        <header class="col-xs-12">
          <h2>{{ journal.articles }} indexed articles</h2>
        </header>

        <div class="col-md-3">
          {% include search-article-filters.html %}
        </div>

        <div class="col-md-9">
          {% include search-article-results.html %}
        </div>
      </section>
    </div>
  </div>

  <footer id="updated" class="page-content__footer">
    <p>
      Added {{journal.created_timestamp.strftime("%e %B %Y")}}
      {% if journal.last_manual_update_timestamp and journal.last_manual_update_timestamp.strftime(app.config.get('DEFAULT_DATE_FORMAT', '%Y-%m-%dT%H:%M:%SZ')) != app.config.get('DEFAULT_TIMESTAMP','1970-01-01T00:00:00Z')%}
      &bull; Updated {{journal.last_manual_update_timestamp.strftime("%e %B %Y")}}
      {% endif %}
    </p>
  </footer>

</main>

{% endblock %}

{% block extra_js_bottom %}

    <script type="text/javascript">
        {% set toc_issns_js_str = '"' + toc_issns | join('","') + '"' %}
        $.extend(true, doaj, {
            publicToCConfig : {
                publicSearchPath : '{{ url_for("query.query", path="article/_search") }}?ref=toc',
                tocIssns : [{{ toc_issns_js_str | safe }}]
            }
        });

        $(document).ready(function() {
            $("#journal_details").hide();
            $("#journal_details_toggle").click(function (event) {
                event.preventDefault();
                $("#journal_details").toggle();
                var jd = $("#journal_details_toggle");
                if (jd.html() == "More") {
                    jd.html("Less")
                } else {
                    jd.html("More")
                }
            });
        });
    </script>

    {% include "_edges_common_js.html" %}
    <script type="text/javascript" src="/static/js/edges/public.toc.edge.js?v={{config.get('DOAJ_VERSION')}}"></script>

{% endblock extra_js_bottom %}
