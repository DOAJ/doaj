{% extends "publisher/publisher_base.html" %}

{% block publisher_content %}

<div class="row-fluid">
    <div class="span12">
        <div class="well">
            <h2>Download</h2>

            <p>List of links to spreadsheets for download</p>

            <table class="table table-striped">
            <thead>
                <tr>
                    <th></th>
                    <th>Created Date</th>
                    <th>Download Link</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>01-01-1970</td>
                    <td><a>http://doaj.org/file.csv</a></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>02-01-1970</td>
                    <td><a>http://doaj.org/file2.csv</a></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>03-01-1970</td>
                    <td><a>http://doaj.org/file3.csv</a></td>
                </tr>
            </tbody>
        </table>
        </div>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <div class="well">
            <h2>Upload</h2>
            <form id="bulk_reapplication_form" method="POST" action="/publisher/reapply" enctype="multipart/form-data">

                <div class="row-fluid">
                    <div class="span4"><strong>Select a file to upload</strong></div>
                    <div class="span6"><input type="file" name="file"></div>
                    <div class="span2"><button class="btn btn-success" id="upload">Upload</button></div>
                </div>
            </form>
            <hr>
            <p>Uploaded files must be less than 50Mb in size.</p>
        </div>
    </div>
</div>

<hr>

{% if previous|length > 0 %}

    <h3>Status of uploaded reapplications (showing last {{previous|length}})</h3>

    <div class="row-fluid">
        <div class="span12">
            <table id="previous_files" style="width: 100%" class="tablesorter">
                <thead>
                    <tr>
                        <th>Upload Date</th>
                        <th>Filename</th>
                        <th>Upload Status</th>
                        <th>Notes</th>
                    </tr>
                </thead>
            {% for file in previous %}
                <tr>
                    <td>
                        {{ file.created_timestamp().strftime("%d %b %Y %H:%M:%S") }}
                    </td>
                    <td>
                        {% if file.filename.startswith("http") %}
                            <a href="{{file.filename}}">{{file.filename}}</a>
                        {% else %}
                            {{file.filename}}
                        {% endif %}
                    </td>
                    <td>
                        {% if file.status == "incoming" %}
                            <span style="color: #000066">in submission</span>
                        {% elif file.status == "validated" %}
                            <span style="color: #000066">pending</span>
                        {% elif file.status == "exists" %}
                            <span style="color: #000066">pending</span>
                        {% elif file.status == "failed" %}
                            <span style="color: #660000">processing failed</span>
                        {% elif file.status == "processed" %}
                            <span style="color: #006600">successfully processed</span>
                        {% elif file.status == "partial" %}
                            <span style="color: #ff3300">partial success</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if file.error %}
                            {{file.error}}
                        {% else %}
                            {% if file.status == "partial" or file.status == "processed" %}
                                {{ file.imported }} articles imported
                                {% if file.imported > 0 %}
                                    ({{file.new}} new, {{file.updates}} updated)
                                {% endif %}
                                {% if file.failed_imports > 0 %}
                                    ; {{ file.failed_imports }} articles failed
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </table>
        </div>
    </div>

{% endif %}

{% endblock %}

{% block extra_js_bottom %}
<script type="text/javascript">
$(document).ready(function() {
    $("#previous_files").tablesorter()
})
</script>

{% endblock %}

