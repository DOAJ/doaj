{% set basic_info_fields =
[
  {"field": "title", "class": "input-xlarge"},
  {"field": "url", "class": "input-xlarge"},
  {"field": "alternative_title", "class": "input-xlarge"},
  {"field": "pissn", "class": "input-small", "size": "9", "maxlength": "9"},
  {"field": "eissn", "class": "input-small", "size": "9", "maxlength": "9"},
  {"field": "publisher", "class": "input-xlarge"},
  {"field": "society_institution", "class": "input-xlarge"},
  {"field": "platform", "class": "input-xlarge"},
  {"field": "contact_name", },
  {"field": "contact_email", },
  {"field": "confirm_contact_email", },
  {"field": "country", "class": "input-large"},
  {"field": "processing_charges", },
  {"field": "processing_charges_amount", "class": "input-mini"},
  {"field": "processing_charges_currency", "class": "input-large"},
  {"field": "submission_charges", },
  {"field": "submission_charges_amount", "class": "input-mini"},
  {"field": "submission_charges_currency", "class": "input-large"},
  {"field": "articles_last_year", "class": "input-mini"},
  {"field": "articles_last_year_url", "class": "input-xlarge"},
  {"field": "waiver_policy", },
  {"field": "waiver_policy_url", "class": "input-xlarge"},
    {
      "field": "digital_archiving_policy",
        "extra_input_field": form.digital_archiving_policy_other,
        "display_extra_when_label_is": other_val,
        "extra_input_field2": form.digital_archiving_policy_library,
        "display_extra2_when_label_is": digital_archiving_policy_specific_library_value,
    },
    {"field": "digital_archiving_policy_url", "class": "input-xlarge"},
  {"field": "crawl_permission", },
  {"field": "article_identifiers", "extra_input_field": form.article_identifiers_other, "display_extra_when_label_is": other_val},
  {"field": "metadata_provision", },
  {"field": "download_statistics", },
  {"field": "download_statistics_url", "class": "input-xlarge"},
  {"field": "first_fulltext_oa_year", "class": "input-mini"},
  {"field": "fulltext_format", "extra_input_field": form.fulltext_format_other, "display_extra_when_label_is": other_val},
  {"field": "keywords", "class": "input-xlarge"},
  {"field": "languages", "class": "input-xlarge"},
]
%}

{% set editorial_process_fields =
[
  {"field": "editorial_board_url", "class": "input-xlarge"},
  {"field": "review_process", },
  {"field": "review_process_url", "class": "input-xlarge"},
  {"field": "aims_scope_url", "class": "input-xlarge"},
  {"field": "instructions_authors_url", "class": "input-xlarge"},
  {"field": "plagiarism_screening", },
  {"field": "plagiarism_screening_url", "class": "input-xlarge"},
  {"field": "publication_time", "class": "input-tiny"},
]
%}

{% set openness_fields =
[
  {"field": "oa_statement_url", "class": "input-xlarge"},
]
%}

{% set content_licensing_fields =
[
  {"field": "license_embedded", },
  {"field": "license_embedded_url", "class": "input-xlarge"},
  {"field": "license", "extra_input_field": form.license_other, "display_extra_when_label_is": other_val},
  {"field": "license_checkbox", },
  {"field": "license_url", "class": "input-xlarge"},
  {"field": "open_access", },
  {"field": "deposit_policy", "extra_input_field": form.deposit_policy_other, "display_extra_when_label_is": other_val},
]
%}

{% set copyright_fields =
[
  {"field": "copyright", "extra_input_field": form.copyright_other, "display_extra_when_label_is": other_val},
  {"field": "copyright_url", "class": "input-xlarge"},
  {"field": "publishing_rights", "extra_input_field": form.publishing_rights_other, "display_extra_when_label_is": other_val},
  {"field": "publishing_rights_url", "class": "input-xlarge"},
]
%}

{% set submitter_info_fields =
[
  {"field": "suggester_name", },
  {"field": "suggester_email", "class": "input-xlarge"},
  {"field": "suggester_email_confirm", "class": "input-xlarge"},
]
%}

{# add a couple of arguments needed by each field when being rendered #}
{% for list_of_fields in basic_info_fields, editorial_process_fields, openness_fields, content_licensing_fields, copyright_fields, submitter_info_fields %}
{% for f_kwargs in list_of_fields %}
  {% do f_kwargs.update({'first_field_with_error': first_field_with_error}) %}
  {% do f_kwargs.update({'q_num': q_numbers.next()}) %}
{% endfor %}
{% endfor %}


{% if admin_page %}
    {% set admin_appstatus_fields =
    [
      {"field": "application_status", "class": "input-large"},
    ]
    %}

    {% set admin_assign_account_fields =
    [
      {"field": "owner", "class": "input-large"},
    ]
    %}

    {% set admin_subject_fields =
    [
      {"field": "subject"},
    ]
    %}
{% endif %}


{% from "_formhelpers.html" import render_field, render_fields %}

<form method="post" action="#first_problem" class="form-horizontal wide" id="suggest_form">
  {% if form.errors %}
    <h4 class="red form-status">There is a problem with the submitted form.</h4>
  {% endif %}

  {% if admin_page %}
      {% if form.application_status.data == 'accepted' %}
        <h4 class="form-status">Please note you <span class="red">cannot edit</span> this application as it has been accepted into the DOAJ.</h4>
      {% endif %}
  {% endif %}

  <fieldset>

    {% if admin_page %}
    <div class="row-fluid">

      <div class="span6">
          <div class="row-fluid">
              {% if editorial_available %}
              <div class="span12 with-borders form-section" style="margin-left: 0;">
                <h3 class="heading-aligned-with-fields">Editorial</h3>
                  {% if group_editable %}
                    {{ render_field(form.editor_group, class="input-large") }}
                  {% else %}
                    {{ render_field(form.editor_group, class="input-large", disabled="disabled") }}
                  {% endif %}

                  {{ render_field(form.editor, class="input-large") }}
              </div>
              {% endif %}

              <div class="span12 with-borders form-section" style="margin-left: 0;">
                  <div class="control-group">
                    <div class="controls">
                        <button class="btn btn-success" type="submit">Save application &gt;</button>
                    </div>
                  </div>
                  {#
                  {{ render_field(form.make_all_fields_optional) }}
                  #}
              </div>

              <div class="span12 with-borders form-section" style="margin-left: 0;">
                <h3 class="heading-aligned-with-fields">Application status</h3>
                {{ render_fields(form, admin_appstatus_fields) }}
              </div>

              {% if current_user.is_super %}
              <div class="span12 with-borders form-section" style="margin-left: 0;">
                <h3 class="heading-aligned-with-fields">Assign to account</h3>
                {{ render_fields(form, admin_assign_account_fields) }}
              </div>
              {% endif %}
          </div>
      </div>

      <div class="span6 with-borders form-section" id="subjects_outer_container">
        <h3>Subject classification</h3>

        <div class="control-group left-aligned">
          <label class="control-label">Current subjects:</label>
          <div class="controls" style="margin-top: 5px">
            <p>{{ subjectstr }}</p>
          </div>
        </div>

        <div id="subject_tree_container">
          <div id="subject_tree"></div>
          {{ render_fields(form, admin_subject_fields) }}
        </div>

      </div>

    </div>
    {% endif %}

    <div class="row-fluid">

      <div class="span6 with-borders form-section">
        <h3 class="heading-aligned-with-fields">Basic Journal Information</h3>
        {{ render_fields(form, basic_info_fields) }}
      </div>

      <div class="span6 with-borders form-section">
        <h3>Quality and Transparency of the Editorial Process</h3>
        {{ render_fields(form, editorial_process_fields) }}
      </div>

      <div class="span6 with-borders form-section">
        <h3>How Open is the Journal?</h3>
        <p>Please remember that <strong>all</strong> the content of the journal you are applying about <strong>must</strong> be available <strong>immediately</strong> upon publication.</p>
        {{ render_fields(form, openness_fields) }}
      </div>

      <div class="span6 with-borders form-section">
        <h3>Content Licensing</h3>
        {{ render_fields(form, content_licensing_fields) }}
      </div>

      <div class="span6 with-borders form-section">
        <h3>Copyright and Permissions</h3>
        {{ render_fields(form, copyright_fields) }}
      </div>

      <div class="span6 with-borders form-section">
        <h3>A note about the qualifiers for the DOAJ Seal</h3>
        <p>DOAJ promotes best practice in Open Access publishing. To that end, we are introducing the DOAJ Seal for Open Access journals.</p>

        <p>The qualifiers for the Seal will highlight features related to the openness, indexability and discoverability of the journal and, as such, have nothing to do with <strong>the scholarly quality of the papers published in the journal</strong>.</p>

        <p>To qualify for the Seal the journal must:</p>
          <ol>
            <li>have an archival arrangement in place with an external party. <a class="animated" href="#digital_archiving_policy-container">(scroll to digital archiving policy question)</a> If 'No policy in place' is selected, the journal will not qualify for the Seal.</li>
            <li>provide permanent identifiers in the papers published. <a class="animated" href="#article_identifiers-container">(scroll to article identifiers question)</a> If 'None' is selected, the journal will not qualify for the Seal.</li>
            <li>provide article level metadata to DOAJ. <a class="animated" href="#metadata_provision-container">(scroll to metadata provision question)</a> If 'No' is selected or the journal fails to provide metadata within 3 months, the journal will not qualify for the Seal.</li>
            <li>embed machine-readable CC licensing information in its article level metadata. <a class="animated" href="#license_embedded-container">(scroll to embedded licensing data question)</a> If 'No' is selected the journal will not qualify for the Seal.</li>
            <li>allow reuse and remixing of its content in accordance with a CC BY or CC BY-NC. <a class="animated" href="#license-container">(scroll to licensing question)</a> If CC BY-ND, 'No' or '{{other_val}}' is selected the journal will not qualify for the Seal.</li>
            <li>have a deposit policy registered in a deposit policy directory. <a class="animated" href="#deposit_policy-container">(scroll to deposit policy question)</a> If 'No' is selected the journal will not qualify for the Seal.</li>
          </ol>

        <p>A journal cannot apply for the Seal. The Seal will be awarded to a journal by the DOAJ Editorial staff depending on the information provided in the application form.</p>
      </div>

    </div>

    <div class="row-fluid">
      <div class="span3">&nbsp;</div>
      <div class="span6 with-borders form-section">
        <h3 class="heading-aligned-with-fields">{% if admin_page %}Details of person making this application{% else %}Your details{% endif %}</h3>
          {{ render_fields(form, submitter_info_fields) }}
        <div class="control-group">
            <div class="controls">
                <button class="btn btn-success" type="submit">
                    {% if not admin_page %}
                        Submit &gt;
                    {% else %}
                        Save application &gt;
                    {% endif %}
                </button>
            </div>
        </div>

      </div>
    </div>

    {% if admin_page %}
    <div class="row-fluid">

      <div class="span12 with-borders form-section">
        <h3>Notes</h3>
        {% set subfield_display = {'note': '8', 'date': '3'} %}

        {% set subfield_display_kwargs = {} %}
        {% for subfield, span_width in subfield_display.items() %}
          {% do subfield_display_kwargs.update({'subfield_display-' + subfield: span_width}) %}
        {% endfor %}

        <div class="addable-field-container" id="notes-outer-container">
          {% if current_user.has_role("delete_note") %}
                {{ render_field(form.notes, render_subfields_horizontal=True, container_class="deletable", **subfield_display_kwargs) }}
            {% else %}
                {{ render_field(form.notes, render_subfields_horizontal=True, **subfield_display_kwargs) }}
            {% endif %}
        </div>
      </div>

    </div>
    {% endif %}

  </fieldset>
</form>
